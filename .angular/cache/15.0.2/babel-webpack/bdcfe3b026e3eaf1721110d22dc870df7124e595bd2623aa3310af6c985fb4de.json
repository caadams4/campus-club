{"ast":null,"code":"import _asyncToGenerator from \"/home/squanch/bk/campus-club/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { GoogleLoginProvider } from \"@abacritt/angularx-social-login\";\nimport { EventEmitter } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@abacritt/angularx-social-login\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/material/button\";\nfunction AuthComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"div\", 6)(2, \"div\", 7)(3, \"h3\");\n    i0.ɵɵtext(4, \"Welcome to Campus Meet!\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\");\n    i0.ɵɵtext(6, \"Sign in to your UD affliated Google account to get started.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 8);\n    i0.ɵɵelement(8, \"div\", 9);\n    i0.ɵɵelementStart(9, \"div\", 9);\n    i0.ɵɵelement(10, \"asl-google-signin-button\", 10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(11, \"div\", 9);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"div\", 9);\n    i0.ɵɵelement(13, \"img\", 11);\n    i0.ɵɵelementEnd()()();\n  }\n}\nfunction AuthComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function AuthComponent_div_6_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.signOut());\n    });\n    i0.ɵɵtext(2, \"Leave\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport class AuthComponent {\n  // Client ID 37067624154-p8nctlpvjafdudjost7418i6l3981opq.apps.googleusercontent.com\n  // Client Secret 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\n  constructor(_authService) {\n    this._authService = _authService;\n    this.auth = new EventEmitter();\n    this.GoogleLoginProvider = GoogleLoginProvider;\n    this.image_path = './sample.png';\n  }\n  sendAuth() {\n    // This shares data from the child component, emits to the PARENT component.\n    // Note: data emitted here, through child html, into parent html, explicitly recieved by parent  \n    // Resource for sharing data between components: https://fireship.io/lessons/sharing-data-between-angular-components-four-methods/\n    this.auth.emit(this.user);\n  }\n  ngOnInit() {\n    this.signIn();\n  }\n  signOut() {\n    this._authService.signOut();\n    console.log(this.user);\n    this.sendAuth();\n  }\n  refreshGoogleToken() {\n    this._authService.refreshAuthToken(GoogleLoginProvider.PROVIDER_ID).then(user => {\n      console.log(user);\n    });\n  }\n  signIn() {\n    var _this = this;\n    this._authService.authState.subscribe( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (user) {\n        let user_proifile;\n        _this.user = user;\n        if (_this.user.email.length > 8 && _this.user.email.endsWith(\"@udel.edu\")) {\n          // user is signed in and added to the database. Render app\n          _this.sendAuth();\n        } else {\n          alert(\"Sorry, this is for University of Delaware students only. If you are, sign in with your school email.\");\n        }\n        _this.loggedIn = user != null;\n        // check for user in database\n        user_proifile = yield _this.find_user(_this.user.id, user_proifile);\n        // if not in database, create user and sent to database\n        if (!user_proifile) {\n          user_proifile = yield _this.create_user(_this.user, user_proifile);\n        }\n      });\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n  find_user(id, user_profile) {\n    return _asyncToGenerator(function* () {\n      // Fetch the user profile on sign in.\n      var body_parameters = {\n        'id': id\n      };\n      var formBody = \"\";\n      formBody += encodeURIComponent('id') + \"=\" + encodeURIComponent(body_parameters['id']);\n      let request = {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'\n        },\n        body: formBody\n      };\n      user_profile = yield fetch('http://127.0.0.1:3000/api/user/find', request).then(response => response.json()).then(user => {\n        return user;\n      }).catch();\n      if (user_profile) {\n        return user_profile['document'];\n      }\n    })();\n  }\n  create_user(user, user_profile) {\n    return _asyncToGenerator(function* () {\n      var body_parameters = {\n        'id': user.id,\n        'username': user.firstName + user.lastName[0],\n        'interests': '[]',\n        'groups': '[]'\n      };\n      var formBody = [];\n      for (var property in body_parameters) {\n        var encodedKey = encodeURIComponent(property);\n        var encodedValue = encodeURIComponent(body_parameters[property]);\n        formBody.push(encodedKey + \"=\" + encodedValue);\n      }\n      formBody = formBody.join(\"&\");\n      let request = {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'\n        },\n        body: formBody\n      };\n      user_profile = yield fetch('http://127.0.0.1:3000/api/user/', request).then(response => response.json()).then(user => {\n        return user;\n      });\n      if (user_profile) {\n        return user_profile['document'];\n      }\n    })();\n  }\n  static #_ = this.ɵfac = function AuthComponent_Factory(t) {\n    return new (t || AuthComponent)(i0.ɵɵdirectiveInject(i1.SocialAuthService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AuthComponent,\n    selectors: [[\"app-auth\"]],\n    outputs: {\n      auth: \"auth\"\n    },\n    decls: 7,\n    vars: 2,\n    consts: [[\"charset\", \"utf-8\"], [\"name\", \"viewport\", \"content\", \"width=device-width, initial-scale=1\"], [\"href\", \"https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css\", \"rel\", \"stylesheet\", \"integrity\", \"sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC\", \"crossorigin\", \"anonymous\"], [\"class\", \"container h \", 4, \"ngIf\"], [\"class\", \"card text-center\", 4, \"ngIf\"], [1, \"container\", \"h\"], [1, \"row\", \"align-items-center\"], [1, \"col\", \"text-center\"], [1, \"row\"], [1, \"col\"], [\"type\", \"standard\", \"size\", \"large\"], [\"src\", \"https://img.freepik.com/free-vector/oops-404-error-with-broken-robot-concept-illustration_114360-1932.jpg?w=740&t=st=1670221400~exp=1670222000~hmac=558833d946061277a177763926806968f096e81c211803a6d55f0ae3fb3bcf7b\", \"alt\", \"image\"], [1, \"card\", \"text-center\"], [\"mat-raised-button\", \"\", \"color\", \"warn\", 3, \"click\"]],\n    template: function AuthComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"html\")(1, \"head\");\n        i0.ɵɵelement(2, \"meta\", 0)(3, \"meta\", 1)(4, \"link\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(5, AuthComponent_div_5_Template, 14, 0, \"div\", 3);\n        i0.ɵɵtemplate(6, AuthComponent_div_6_Template, 3, 0, \"div\", 4);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngIf\", !ctx.user);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.user);\n      }\n    },\n    dependencies: [i2.NgIf, i1.GoogleSigninButtonDirective, i3.MatButton],\n    styles: [\".signin[_ngcontent-%COMP%], .google_sign_in[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto}.sample[_ngcontent-%COMP%]{position:fixed}.h[_ngcontent-%COMP%]{height:50vh}\"]\n  });\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}