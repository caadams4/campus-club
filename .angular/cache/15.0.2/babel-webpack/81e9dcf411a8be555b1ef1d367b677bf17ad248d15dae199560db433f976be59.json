{"ast":null,"code":"import _asyncToGenerator from \"/home/squanch/bk/campus-club/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { SocialUser } from '@abacritt/angularx-social-login';\nimport { EventEmitter } from '@angular/core';\nimport { ViewEventComponent } from '../view-event/view-event.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/dialog\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/material/button\";\nfunction CardsComponent_div_3_button_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function CardsComponent_div_3_button_17_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const event_r1 = i0.ɵɵnextContext().$implicit;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.leaveEvent(event_r1));\n    });\n    i0.ɵɵtext(1, \"Leave Event\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CardsComponent_div_3_button_18_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function CardsComponent_div_3_button_18_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const event_r1 = i0.ɵɵnextContext().$implicit;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.selectEvent(event_r1));\n    });\n    i0.ɵɵtext(1, \"Join Event\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CardsComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵelement(1, \"br\");\n    i0.ɵɵelementStart(2, \"div\", 5)(3, \"div\", 6)(4, \"h4\", 7)(5, \"u\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"p\", 8);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"p\", 8);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 9)(12, \"div\", 1)(13, \"div\", 2)(14, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function CardsComponent_div_3_Template_button_click_14_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const event_r1 = restoredCtx.$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.openEvent(event_r1));\n    });\n    i0.ɵɵtext(15, \"View Event\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\", 2);\n    i0.ɵɵtemplate(17, CardsComponent_div_3_button_17_Template, 2, 0, \"button\", 11);\n    i0.ɵɵtemplate(18, CardsComponent_div_3_button_18_Template, 2, 0, \"button\", 12);\n    i0.ɵɵelementEnd()()()()()();\n  }\n  if (rf & 2) {\n    const event_r1 = ctx.$implicit;\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(event_r1.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(event_r1.descritption);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(event_r1.dateTimeStart);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngIf\", event_r1.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !event_r1.id);\n  }\n}\nexport class CardsComponent {\n  constructor(dialog) {\n    this.dialog = dialog;\n    this.user = new SocialUser();\n    this.event_list = [];\n    this.event_list_joined = new EventEmitter();\n  }\n  sendList() {\n    // This shares data from the child component, emits to the PARENT component.\n    // Note: data emitted here, through child html, into parent html, explicitly recieved by parent  \n    // Resource for sharing data between components: https://fireship.io/lessons/sharing-data-between-angular-components-four-methods/\n    this.event_list_joined.emit(this.event_list_joined);\n  }\n  leaveEvent(event) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      _this.joinedEvent = event;\n      console.log(_this.joinedEvent);\n      var body_parameters = {\n        'id': event._id,\n        'attendees': _this.user.firstName + _this.user.lastName[0]\n      };\n      console.log(body_parameters);\n      var formBody = [];\n      for (var property in body_parameters) {\n        var encodedKey = encodeURIComponent(property);\n        var encodedValue = encodeURIComponent(body_parameters[property]);\n        formBody.push(encodedKey + \"=\" + encodedValue);\n      }\n      formBody = formBody.join(\"&\");\n      let resp = yield fetch('http://127.0.0.1:3000/api/event/removeUser', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'\n        },\n        body: formBody\n      });\n      console.log(\"Need to wait for db to write new event\");\n      setTimeout(() => {}, 250);\n      console.log(\"Done waiting, now pull!\");\n      _this.sendList();\n    })();\n  }\n  selectEvent(event) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2.joinedEvent = event;\n      console.log(_this2.joinedEvent);\n      var body_parameters = {\n        'id': event._id,\n        'attendees': _this2.user.firstName + _this2.user.lastName[0]\n      };\n      console.log(body_parameters);\n      var formBody = [];\n      for (var property in body_parameters) {\n        var encodedKey = encodeURIComponent(property);\n        var encodedValue = encodeURIComponent(body_parameters[property]);\n        formBody.push(encodedKey + \"=\" + encodedValue);\n      }\n      formBody = formBody.join(\"&\");\n      let resp = yield fetch('http://127.0.0.1:3000/api/event/addUser', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'\n        },\n        body: formBody\n      });\n      console.log(\"Need to wait for db to write new event\");\n      setTimeout(() => {}, 250);\n      console.log(\"Done waiting, now pull!\");\n      _this2.sendList();\n    })();\n  }\n  openEvent(event) {\n    console.log(event);\n    const dialogRef = this.dialog.open(ViewEventComponent, {\n      width: '40%',\n      height: '44vh',\n      data: {\n        event: event,\n        user: this.user\n      }\n    });\n    dialogRef.afterClosed().subscribe(result => {\n      this.sendList();\n      this.new_event = result;\n    });\n  }\n  pullEvents(event_list) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      // Fetch the events when funciton is called.\n      console.log(\"Pulling events! \", event_list);\n      let request = {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'\n        }\n      };\n      event_list = yield fetch('http://127.0.0.1:3000/api/event', request).then(response => response.json()).then(user => {\n        return user;\n      }).catch();\n      if (event_list) {\n        let event_list_len = event_list['documents'].length;\n        for (let i = 0; i < event_list_len; i++) {\n          let lati = event_list['documents'][i].coordinates[0];\n          let long = event_list['documents'][i].coordinates[1];\n          event_list['documents'][i].dateTimeEnd = new Date(event_list['documents'][i].dateTimeEnd);\n          event_list['documents'][i].dateTimeStart = new Date(event_list['documents'][i].dateTimeStart);\n          console.log('--------------------');\n          let attendees = event_list['documents'][i].attendees;\n          if (_this3.user) console.log(\"USER IN EVENT\", _this3.user.firstName + _this3.user.lastName[0], attendees);\n          if (_this3.user && attendees.includes(_this3.user?.firstName + _this3.user?.lastName[0])) {\n            // check if a member of, if true, render a leave button\n            console.log(\"Found a user\");\n            event_list['documents'][i].id = true;\n          } else {\n            event_list['documents'][i].id = false;\n          }\n        }\n        console.log(event_list);\n        return event_list['documents'];\n      }\n    })();\n  }\n  static #_ = this.ɵfac = function CardsComponent_Factory(t) {\n    return new (t || CardsComponent)(i0.ɵɵdirectiveInject(i1.MatDialog));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CardsComponent,\n    selectors: [[\"app-cards\"]],\n    inputs: {\n      user: \"user\",\n      event_list: \"event_list\"\n    },\n    outputs: {\n      event_list_joined: \"event_list_joined\"\n    },\n    decls: 4,\n    vars: 1,\n    consts: [[1, \"list_master\", \"container\"], [1, \"row\"], [1, \"col\"], [\"class\", \"card_list text-center\", 4, \"ngFor\", \"ngForOf\"], [1, \"card_list\", \"text-center\"], [1, \"card\"], [1, \"card-body\"], [1, \"card-header\"], [1, \"card-text\"], [1, \"card-footer\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [\"mat-raised-button\", \"\", \"color\", \"warn\", 3, \"click\", 4, \"ngIf\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\", 4, \"ngIf\"], [\"mat-raised-button\", \"\", \"color\", \"warn\", 3, \"click\"]],\n    template: function CardsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2);\n        i0.ɵɵtemplate(3, CardsComponent_div_3_Template, 19, 5, \"div\", 3);\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngForOf\", ctx.event_list);\n      }\n    },\n    dependencies: [i2.NgForOf, i2.NgIf, i3.MatButton],\n    styles: [\".card_list[_ngcontent-%COMP%]{max-height:90vh;padding-top:1;padding-right:1;margin-right:0;margin-top:1}.card-footer[_ngcontent-%COMP%]{background-color:#fff6cc}.card-body[_ngcontent-%COMP%]{padding:0}.list_master[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;align-items:center}.card-header[_ngcontent-%COMP%]{margin-top:1;background-color:#cce6ff}#header-buttons[_ngcontent-%COMP%]{margin-right:35px;float:right;height:68px;width:auto;border:1px solid red;display:flex;align-items:center;justify-content:center}\"]\n  });\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}